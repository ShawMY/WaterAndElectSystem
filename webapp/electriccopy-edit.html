<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="Bookmark" href="favicon.ico">
		<link rel="Shortcut Icon" href="favicon.ico" />
		<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
		<!--/meta 作为公共模版分离出去-->

		<title>添加用户 - H-ui.admin v3.0</title>
		<meta name="keywords" content="H-ui.admin v3.0,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
		<meta name="description" content="H-ui.admin v3.0，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
	</head>

	<body>
		<article class="cl pd-20">
			<form class="form form-horizontal" id="form-member-add">
				<div class="row cl">
					<label class="form-label col-xs-2 col-sm-2">电表编号：</label>
					<div class="formControls col-xs-9 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="meterCode" name="meterCode" disabled>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-2 col-sm-2">抄表编号：</label>
					<div class="formControls col-xs-9 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="copyCode" name="copyCode" disabled>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-2 col-sm-2"><span class="c-red">*</span>安装地址：</label>
					<div class="formControls col-xs-2 col-sm-2">
						<span class="select-box">
							<select class="select" size="1" name="installAddress1" id="installAddress1">
								<option value="0" selected>下沙教学区</option>
								<option value="1">下沙钱江湾</option>
								<option value="2">下沙金沙港</option>
								<option value="3">下沙玉屏洲</option>
								<option value="4">教工路校区</option>
							</select>
						</span>
					</div>
					<div class="formControls col-xs-2 col-sm-2">
						<span class="select-box">
							<select class="select" size="1" name="installAddress2" id="installAddress2">
								<option value="0" selected>学生公寓</option>
								<option value="1">食堂</option>
							</select>
						</span>
					</div>
					<div class="formControls col-xs-2 col-sm-2">
						<span class="select-box">
							<select class="select" size="1" name="installAddress3" id="installAddress3">
								<option value="0" selected>学生公寓</option>
								<option value="1">食堂</option>
							</select>
						</span>
					</div>
					<div class="formControls col-xs-3 col-sm-3">
						<input type="text" class="input-text" value="" placeholder="" id="installAddress4" name="installAddress4">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-2 col-sm-2"><span class="c-red">*</span>上期读数：</label>
					<div class="formControls col-xs-3 col-sm-3">
						<input type="text" class="input-text" value="" placeholder="" id="previousNum" name="previousNum">
					</div>
					<label class="form-label col-xs-2 col-sm-2 col-sm-offset-1"><span class="c-red">*</span>最近抄表日期：</label>
					<div class="formControls col-xs-3 col-sm-3">
						<input type="text" onfocus="WdatePicker({maxDate:'%y-%M-%d'})" id="recordTime" name="recordTime" class="input-text Wdate" style="width:100%;">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-2 col-sm-2"><span class="c-red">*</span>抄表员：</label>
					<div class="formControls col-xs-3 col-sm-3">
						<input type="text" class="input-text" value="" placeholder="" id="recordPeople" name="recordPeople">
					</div>
				</div>
				<div class="row cl">
					<div class="col-xs-10 col-sm-10 col-xs-offset-1 col-sm-offset-1">
						<input class="btn btn-primary radius btn-block" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
					</div>
				</div>
			</form>
		</article>

		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="ip.js"></script>
		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.page.js"></script>
		<!--/_footer /作为公共模版分离出去-->

		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
		<script type="text/javascript">
			$(function() {
//				var ip = 'http://101.132.45.14:8080/shuidiansystem';
				var chgUrl = '/api/electric/copy/chg',
					getItemUrl = '/api/address/level/item';

				$('.skin-minimal input').iCheck({
					checkboxClass: 'icheckbox-blue',
					radioClass: 'iradio-blue',
					increaseArea: '20%'
				});

				$("#form-member-add").validate({
					rules: {
						firstLevel: {
							required: true
						},
						secondLevel: {
							required: true
						},
						thirdLevel: {
							required: true
						},
						previousNum: {
							required: true
						},
						recordTime: {
							required: true
						},
						recordPeople: {
							required: true
						},
					},
					onkeyup: false,
					focusCleanup: true,
					success: "valid",
					submitHandler: function(form) {
						submit();

						var index = parent.layer.getFrameIndex(window.name);
						parent.layer.close(index);
					}
				});

				function submit() {
					$.ajax({
						type: "post",
						url: ip + chgUrl,
						data: JSON.stringify({
							copyCode: $('#copyCode').val(),
							installAddress1: $('#installAddress1').val(),
							installAddress2: $('#installAddress2').val(),
							installAddress3: $('#installAddress3').val(),
							installAddress4: $('#installAddress4').val(),
							installAddress5: '',
							installAddress6: '',
							previousNum: $('#previousNum').val(),
							recordTime: $('#recordTime').val(),
							recordPeople: $('#recordPeople').val(),
						}),
						contentType: 'application/json',
						dataType: 'json',
						success: function(res) {
							if(res.code == 200) {
								layer.msg(res.msg, {
									icon: 1,
									time: 1000
								});
							} else {
								layer.msg(res.msg, {
									icon: 2,
									time: 1000
								});
							}
						},
						async: false
					});
				}

				var getAddrUrl = '/api/address/preLevel';
				
				function setSecond(code) {
					//填充二级地址
					$.ajax({
						type: "get",
						url: ip + getAddrUrl,
						data: {
							level: "二级",
							preCode: code
						},
						success: function(res) {
							var str = "";
							$.each(res.content, function(index, value) {
								str = str + "<option value='" + value.name + "' name='" + value.code + "'>" + value.name + "</option>";
							});
							$("#installAddress2").html(str);
							setThird(res.content[0].code);
						},
						async: true
					});
				}

				function setThird(code) {
					//填充三级地址
					$.ajax({
						type: "get",
						url: ip + getAddrUrl,
						data: {
							level: "三级",
							preCode: code
						},
						success: function(res) {
							var str = "";
							$.each(res.content, function(index, value) {
								str = str + "<option value='" + value.name + "' name='" + value.code + "'>" + value.name + "</option>";
							});
							$("#installAddress3").html(str);
							$("#installAddress4").attr("disabled", false);
						},
						async: true
					});
				}
				
				$("#installAddress1").on('change', function() {
					setSecond($("#installAddress1 option:checked").attr("name"));
				});

				$("#installAddress2").on('change', function() {
					setThird($("#installAddress2 option:checked").attr("name"));
				});

				$("#installAddress3").on('change', function() {
					if($(this).val() != "") {
						$("#installAddress4").attr("disabled", false);
					}
				});
			});
		</script>
		<!--/请在上方写此页面业务相关的脚本-->
	</body>

</html>