<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="Bookmark" href="favicon1.ico">
		<link rel="Shortcut Icon" href="favicon1.ico" />
		<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
		<!--/meta 作为公共模版分离出去-->

		<title>水表历史信息 - 水表管理 - 浙江工商大学水电管理系统</title>
	</head>

	<body>
		<!--_header 作为公共模版分离出去-->
		<div class="_header"></div>
		<!--/_header 作为公共模版分离出去-->

		<!--_menu 作为公共模版分离出去-->
		<div class="_menu"></div>
		<!--/_menu 作为公共模版分离出去-->

		<section class="Hui-article-box">
			<div class="Hui-article">
				<article class="cl pd-5">
					<!--<div class="cl">
						<form class="form form-horizontal" id="form-member-add">
							<div class="col-sm-12">
								<div class="col-sm-3 pl-0 pr-0">
									<label class="form-label col-xs-4 col-sm-4 pr-0">水表编号：</label>
									<div class="formControls col-xs-8 col-sm-8 pl-0 pr-0">
										<input type="text" class="input-text" value="" placeholder="" id="code" name="code">
									</div>
								</div>
								<div class="col-sm-3 pl-0 pr-0">
									<label class="form-label col-xs-4 col-sm-4 pl-0 pr-0">级别：</label>
									<div class="formControls col-xs-8 col-sm-8 pl-0 pr-0">
										<span class="select-box">
										<select class="select" size="1" name="level" id="level">
											<option value="一级" selected>一级</option>
											<option value="二级">二级</option>
											<option value="三级">三级</option>
											<option value="四级">四级</option>
										</select>
									</span>
									</div>
								</div>
								<div class="col-sm-3 pl-0 pr-0">
									<label class="form-label col-xs-4 col-sm-4 pl-0 pr-0">安装时间：</label>
									<div class="formControls col-xs-8 col-sm-8 pl-0 pr-0">
										<input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'deadTime\')||\'%y-%M-%d\'}'})" id="installTime" name="installTime" class="input-text Wdate" style="width:100%;">
									</div>
								</div>
							</div>
							<div class="col-sm-12 mt-10">
								<div class="col-sm-3 pl-0 pr-0 hidden" id="element-preLevel">
									<label class="form-label col-xs-4 col-sm-4 pr-0">上级编号：</label>
									<div class="formControls col-xs-8 col-sm-8 pl-0 pr-0">
										<input type="text" class="input-text" value="" placeholder="" id="preLevel" name="preLevel">
									</div>
								</div>
								<div class="col-sm-3 pl-0 pr-0">
									<label class="form-label col-xs-4 col-sm-4 pl-0 pr-0">安装地址：</label>
									<div class="formControls col-xs-8 col-sm-8 pl-0 pr-0">
										<input type="text" class="input-text" value="" placeholder="" id="installAddress" name="installAddress">
									</div>
								</div>
								<div class="col-sm-3 pl-0 pr-0">
									<label class="form-label col-xs-4 col-sm-4 pl-0 pr-0">报废时间：</label>
									<div class="formControls col-xs-8 col-sm-8 pl-0 pr-0">
										<input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'installTime\')}',maxDate:'%y-%M-%d'})" id="deadTime" name="deadTime" class="input-text Wdate" style="width:100%;">
									</div>
								</div>
								<div class="col-sm-3 pl-0 pr-0 text-c">
									<button class="btn btn-success radius" id="btn-search" name=""><i class="Hui-iconfont">&#xe665;</i> 查询</button>
								</div>
							</div>
						</form>
					</div>-->
					<div class="mt-20">
						<table id="example1" class="table table-border table-bordered table-hover table-bg table-sort" cellspacing="0" width="100%">
							<thead>
								<tr>
									<!--<th><input type="checkbox" name="keeperUserGroup-checkable" value="" id="allChecked"></th>-->
									<th>序号</th>
									<th>水表编号</th>
									<th>安装时间</th>
									<th>报废时间</th>
									<th>翻表次数</th>
									<th>最终读数</th>
								</tr>
							</thead>
						</table>
						<div id="paging" class="text-c mt-30"></div>
					</div>
				</article>
			</div>
		</section>

		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="ip.js"></script>
		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.page.js"></script>
		<!--/_footer /作为公共模版分离出去-->

		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
		<script type="text/javascript">
			/*公共数据*/
//			var ip = 'http://101.132.45.14:8080/shuidiansystem';
			var getUrl = '/api/water/history';
			var delUrl = '/api/water/history';
			var getItemUrl = '/api/address/level/item';
			//			var chgStatusUrl = '/api/water/meter/status';
			//表格数据
			var dataSet = [];

			$(function() {
				/*导入公共组件*/
				$("._header").load("_header.html");
				$("._menu").load("_menu.html");
				isLogin();
				getList(1);
			});
			
			function isLogin() {
				if($.cookie("isLogin") == 'null') {
					window.location.href="loginTip.html";
				}
			}

			/*填充表格*/
			function setTable() {
				//checked
				checkedSet = [];

				/*表格数据动态渲染*/
				var resultTable = $('#example1').DataTable({
					data: dataSet,
					columns: [
						/*{
							className: "td-checkbox",
							data: null,
							width: '30px',
							render: function(data, type, row, meta) {
								//								console.log(data);
								var content = '<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">';
								content += '	<input type="checkbox" class="group-checkable" value="' + data.typeCode + '" />';
								content += '	<span></span>';
								content += '</label>';
								return content;
							}
						},*/
						{
							title: "序号",
							data: null,
							width: "30px"
						},
						{
							title: "水表编号",
							data: "code"
						},
						{
							title: "安装时间",
							data: "installTime"
						},
						{
							title: "拆除时间",
							data: "deadTime"
						},
						{
							title: "翻表次数",
							data: "transCount"
						},
						{
							title: "最终读数",
							data: "finalNum"
						}
					],
					aoColumnDefs: [{
						orderable: false,
						aTargets: [0]
					}],
					paging: false,
					bFilter: false,
					info: false,
				});

				/* 设置第一列 - 序列化 */
				resultTable.on('order.dt search.dt', function() {
					resultTable.column(0, {
						search: 'applied',
						order: 'applied'
					}).nodes().each(function(cell, i) {
						cell.innerHTML = i + 1;
					});
				}).draw();
			}

			/* 根据分页获取列表信息 */
			function getList(curr) {
				$.ajax({
					type: "get",
					url: ip + getUrl,
					data: {
						page: curr
					},
					success: function(res) {
						if(res.code == 200) {
							dataSet = res.content.info;
							if($('#example1').hasClass('dataTable')) {
								var oldTable = $('#example1').dataTable();
								oldTable.fnClearTable(); //清空一下table
								oldTable.fnDestroy(); //还原初始化了的dataTable
								$('#example1').empty();
							}
							setTable();
							pagination(res.content.page, res.content.pageNum, 0);
						}
						else {
							layer.msg(res.msg, {
								icon: 2,
								time: 3000
							});
						}
					},
					async: true
				});
			}

			/*用户-查询*/
			$("#btn-search").click(function() {
				search(1);
			});

			function search(curr) {
//				var ip = '';
				var searchUrl = '/api/water/history/search';

				$.ajax({
					type: "get",
					url: ip + searchUrl,
					data: {
						code: $('#code').val(),
						installTime: $('#installTime').val(),
						deadTime: $('#deadTime').val(),
						transCount: $('#transCount').val(),
						finalNum: $('#finalNum').val(),
						installAddress: $('#installAddress').val(),
						page: curr
					},
					success: function(res) {
						if(res.code == 200) {
							dataSet = res.content.info;
							if($('#example1').hasClass('dataTable')) {
								var oldTable = $('#example1').dataTable();
								oldTable.fnClearTable(); //清空一下table
								oldTable.fnDestroy(); //还原初始化了的dataTable
								$('#example1').empty();
							}
							setTable();
							pagination(res.content.page, res.content.pageNum, 1);
						}
						else {
							layer.msg(res.msg, {
								icon: 2,
								time: 3000
							});
						}
					},
					async: true
				});
			}

			//分页
			function pagination(curr, sum, type) { //type表示当前的分页方式
				laypage({
					cont: 'paging', //容器。值支持id名、原生dom对象，jquery对象。【如该容器为】：&lt;div id="page1">&lt;/div>
					pages: sum, //通过后台拿到的总页数
					curr: curr, //初始化当前页
					jump: function(e, first) { //触发分页后的回调
						if(!first) {
							if(type == 0) { //如果本次触发与查询无关
								getList(e.curr);
							} else {
								search(e.curr);
							}
						}

					}
				});
			}

			
		</script>
		<!--/请在上方写此页面业务相关的脚本-->
	</body>

</html>