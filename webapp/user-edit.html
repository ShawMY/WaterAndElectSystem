<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="Bookmark" href="favicon.ico">
		<link rel="Shortcut Icon" href="favicon.ico" />
		<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
		<!--/meta 作为公共模版分离出去-->

		<title>编辑用户信息</title>
	</head>

	<body>
		<article class="cl pd-20">
			<form action="/api/user/chg" method="post" class="form form-horizontal" id="form-member-add">
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3">用户编号：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" class="input-text" value="" placeholder="" id="code" name="code" disabled>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>用户名称：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" class="input-text" value="" placeholder="" id="name" name="name">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>用户类别：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<span class="select-box">
							<select class="select" size="1" name="typeName" id="typeName">
								<!--<option value="1" selected>公共</option>-->
							</select>
						</span>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>付款方式：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<span class="select-box">
							<select class="select" size="1" name="payment" id="payment">
								<option value="人工付款" selected>人工付款</option>
								<option value="自动付款">自动付款</option>
								<option value="预缴费">预缴费</option>
								<option value="后缴费">后缴费</option>
							</select>
						</span>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>表记类别：</label>
					<div class="formControls col-xs-6 col-sm-7 skin-minimal">
						<span class="select-box">
							<select class="select" size="1" name="meterType" id="meterType">
								<option value="水" selected>水</option>
								<option value="电">电</option>
							</select>
						</span>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>表记编号：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<span class="select-box">
							<select class="select" size="1" name="meterCode" id="meterCode">
							</select>
						</span>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>开户时间：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'closeTime\')||\'%y-%M-%d\'}'})" id="openTime" name="openTime" class="input-text Wdate" style="width:100%;">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>销户时间：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'openTime\')}',maxDate:'%y-%M-%d'})" id="closeTime" name="closeTime" class="input-text Wdate" style="width:100%;">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>联系人：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" class="input-text" value="" placeholder="" id="contactPeople" name="contactPeople">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>联系电话：</label>
					<div class="formControls col-xs-6 col-sm-7">
						<input type="text" class="input-text" value="" placeholder="" id="contactPhone" name="contactPhone">
					</div>
				</div>
				<div class="row cl">
					<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
						<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
					</div>
				</div>
			</form>
		</article>

		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="ip.js"></script>
		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.page.js"></script>
		<!--/_footer /作为公共模版分离出去-->

		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
		<script type="text/javascript">
			$(function() {
//				var ip = 'http://101.132.45.14:8080/shuidiansystem_war';
				var chgUrl = '/api/user/chg';

				$('.skin-minimal input').iCheck({
					checkboxClass: 'icheckbox-blue',
					radioClass: 'iradio-blue',
					increaseArea: '20%'
				});

				$("#form-member-add").validate({
					rules: {
						name: {
							required: true
						},
						typeName: {
							required: true
						},
						payment: {
							required: true
						},
						meterType: {
							required: true
						},
						meterCode: {
							required: true
						},
						openTime: {
							required: true
						},
						closeTime: {
							required: true
						},
						contactPeople: {
							required: true
						},
						contactPhone: {
							required: true
						}
					},
					onkeyup: false,
					focusCleanup: true,
					success: "valid",
					submitHandler: function(form) {
						submit();

						var index = parent.layer.getFrameIndex(window.name);
						parent.layer.close(index);
					}
				});

				function submit() {
					$.ajax({
						type: "post",
						url: ip + chgUrl,
						data: JSON.stringify({
							code: $('#code').val(),
							name: $('#name').val(),
							typeName: $('#typeName option:selected').text(),
							typeCode: $('#typeName').val(),
							payment: $('#payment').val(),
							meterType: $('#meterType').val(),
							meterCode: $('#meterCode').val(),
							openTime: $('#openTime').val(),
							closeTime: $('#closeTime').val(),
							contactPeople: $('#contactPeople').val(),
							contactPhone: $('#contactPhone').val()
						}),
						contentType: 'application/json',
						dataType: 'json',
						success: function(res) {
							if(res.code == 200) {
								layer.msg(res.msg, {
									icon: 1,
									time: 1000
								});
							} else {
								layer.msg(res.msg, {
									icon: 2,
									time: 1000
								});
							}
						},
						async: false
					});
				}
				
				$("#meterType").on('change', function() {
					getCode($(this).val());
				});

				function getCode(type) {
					//根据表记类型获取所有表记编号
					var getCodeUrl = '/api/code/meter';
					$.ajax({
						type: "get",
						url: ip + getCodeUrl,
						async: true,
						data: {
							type: type
						},
						success: function(res) {
							var data = res.content;
							var str = "";
							$.each(data, function(index, value) {
								str = str + "<option value=" + value + ">" + value + "</option>";
							});
							//将用户类别填充到搜索部分
							$("#meterCode").html(str);
						}
					});
				}
				
			});
		</script>
		<!--/请在上方写此页面业务相关的脚本-->
	</body>

</html>